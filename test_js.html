<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript测试</title>
</head>
<body>
    <h1>JavaScript测试页面</h1>
    <div id="test-result">等待测试...</div>

    <script>
        // 测试fetch API
        async function testFetch() {
            try {
                const response = await fetch('/api/stocks');
                const data = await response.json();
                document.getElementById('test-result').innerHTML =
                    `API测试成功！获取到${data.stocks.length}条股票数据`;
                console.log('API响应数据:', data);
            } catch (error) {
                document.getElementById('test-result').innerHTML =
                    `API测试失败: ${error.message}`;
                console.error('API测试错误:', error);
            }
        }

        // 测试JavaScript语法
        function testSyntax() {
            try {
                // 测试app.js中的一些函数
                function formatDate(date) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}年${month}月${day}日`;
                }

                function formatPrice(price) {
                    if (typeof price !== 'number') return '-';
                    return price.toFixed(2);
                }

                console.log('语法测试通过');
                console.log('formatDate测试:', formatDate(new Date()));
                console.log('formatPrice测试:', formatPrice(123.456));
                return true;
            } catch (error) {
                console.error('语法测试失败:', error);
                return false;
            }
        }

        // 运行测试
        console.log('开始JavaScript测试...');
        if (testSyntax()) {
            console.log('语法测试通过，开始API测试...');
            testFetch();
        }
    </script>
</body>
</html>